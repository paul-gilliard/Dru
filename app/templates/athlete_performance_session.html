{% extends 'base.html' %}
{% block title %}Séance — {{ program_session.session_name or 'Séance' }}{% endblock %}
{% block content %}
<h2>Séance — {{ program_session.session_name or 'Séance' }}</h2>

<nav style="margin-bottom:12px; display:flex; gap:12px;">
  <a href="{{ url_for('athlete') }}" class="kv">Programme</a>
  <a href="{{ url_for('athlete_journal') }}" class="kv">Journal</a>
  <a href="{{ url_for('athlete_performance') }}" class="kv">Entraînement</a>
</nav>

<div class="card">
  <h3>{{ ['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'][program_session.day_of_week] }}{% if program_session.session_name %} — {{ program_session.session_name }}{% endif %}</h3>
  <p style="margin-bottom:8px;">Exercices proposés : {% if session_exercises %}{{ session_exercises|join(', ') }}{% else %}<em>non renseignés</em>{% endif %}</p>

  <h4>Ajouter une performance (date par défaut aujourd'hui)</h4>
  <form id="perf-add-form" method="post" action="{{ url_for('athlete_performance_session', session_id=program_session.id) }}">
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap:8px;">
      <div>
        <label>Date</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input id="perf-entry-date" name="entry_date" type="date" value="{{ (now().date()|string) }}">
          <!-- <button id="view-summary-btn" type="button" class="secondary" title="Voir résumé de la séance pour la date sélectionnée">Voir le résumé</button> -->
        </div>
      </div>
      <div>
        <label>Exercice</label>
        <select id="perf-exercise" name="exercise" required>
          <option value="">— choisir —</option>
          {% for ex in session_exercises %}
          <option>{{ ex }}</option>
          {% endfor %}
          <option value="Autre">Autre</option>
        </select>
      </div>
      <div><label>Séries (n° série)</label><input name="sets" type="number" step="1" min="1"></div>
      <div><label>Rép (ex: 6.5)</label><input name="reps" type="number" step="0.1" inputmode="decimal"></div>
      <div><label>Poids (kg)</label><input name="load" type="number" step="0.5" inputmode="decimal"></div>
      <div style="grid-column: 1 / -1;"><label>Remarque</label><input name="notes" type="text"></div>
    </div>

    <div style="margin-top:12px;">
      <button type="submit" class="save-program-btn">Ajouter</button>
    </div>
  </form>
</div>

<div class="card" style="margin-top:12px;">
  <h3>Entrées enregistrées pour cette séance</h3>
  {% if perf_entries %}
  <table id="perf-entries-table">
    <thead><tr><th>Date</th><th>Exercice</th><th>S</th><th>Rép</th><th>Poids</th><th>Remarque</th><th>Actions</th></tr></thead>
    <tbody>
      {% for p in perf_entries %}
      <tr data-entry-id="{{ p.id }}" data-entry-date="{{ p.entry_date.isoformat() }}">
        <td class="col-date">{{ p.entry_date.strftime('%Y-%m-%d') }}</td>
        <td class="col-exercise">{{ p.exercise }}</td>
        <td class="center col-sets">{{ p.sets or '' }}</td>
        <td class="center col-reps">{{ p.reps or '' }}</td>
        <td class="center col-load">{{ p.load or '' }}</td>
        <td class="col-notes">{{ p.notes or '' }}</td>
        <td class="col-actions">
          <button type="button" class="edit-perf-btn" data-entry-id="{{ p.id }}">Modifier</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- bouton résumé déplacé ici -->
  <div style="margin-top:12px; display:flex; justify-content:flex-end;">
    <button id="view-summary-btn" type="button" class="secondary">Voir le résumé</button>
  </div>

  {% else %}
    <p class="text-muted">Aucune performance enregistrée pour cette séance.</p>
  {% endif %}
</div>

<!-- Edit modal for performance entry -->
<div id="perf-edit-modal" class="confirm-modal" aria-hidden="true">
  <div class="confirm-modal-backdrop"></div>
  <div class="confirm-modal-panel" role="document">
    <div class="confirm-modal-body">
      <h3>Modifier performance</h3>
      <form id="perf-edit-form" method="post" action="">
        <input type="hidden" id="edit-entry-id" name="entry_id">
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:8px;">
          <div><label>Date</label><input id="edit-entry-date" name="entry_date" type="date" required></div>
          <div><label>Exercice</label><input id="edit-exercise" name="exercise" type="text" required></div>
          <div><label>Séries</label><input id="edit-sets" name="sets" type="number" step="1"></div>
          <div><label>Rép</label><input id="edit-reps" name="reps" type="text"></div>
          <div><label>Poids (kg)</label><input id="edit-load" name="load" type="number" step="0.5"></div>
          <div style="grid-column:1 / -1;"><label>Remarque</label><input id="edit-notes" name="notes" type="text"></div>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
          <button id="perf-edit-save" type="submit" class="save-program-btn">Enregistrer</button>
          <button type="button" id="perf-edit-cancel" class="confirm-no">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/athlete_performance.js') }}"></script>
{% endblock %}